/*
 * generated by Xtext 2.18.0.M3
 */
package org.xtext.tcc.mydsl.validation

import org.eclipse.xtext.validation.Check
import org.xtext.tcc.mydsl.myDsl.Api
import org.xtext.tcc.mydsl.myDsl.Entidade
import org.xtext.tcc.mydsl.myDsl.Atributo
import org.xtext.tcc.mydsl.myDsl.Entidades

/**
 * This class contains custom validation rules. 
 * 
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#validation
 */
class MyDslValidator extends AbstractMyDslValidator {

	EntidadeValidator entidadeValidator = new EntidadeValidator();

//	public static val INVALID_NAME = 'invalidName'
//
//	@Check
//	def checkGreetingStartsWithCapital(Greeting greeting) {
//		if (!Character.isUpperCase(greeting.name.charAt(0))) {
//			warning('Name should start with a capital', 
//					MyDslPackage.Literals.GREETING__NAME,
//					INVALID_NAME)
//		}
//	}
	@Check
	def validaNomes(Api api) {
		api.nomeApi.nome = api.nomeApi.nome.substring(1, api.nomeApi.nome.length - 1);
		validaEntidade(api.entidades.entidade);
		println(api.entidades.entidade.nomeEntidade.nome)
		if(api.entidades.entidadeMais.size() > 0){
			for(entidade: api.entidades.entidadeMais){
				validaEntidade(entidade);
				println(entidade.nomeEntidade.nome)
			}
		}
	}
	
	def validaEntidade(Entidade entidade){
		entidade.nomeEntidade.nome = entidade.nomeEntidade.nome.substring(1, entidade.nomeEntidade.nome.length);
		entidade.package.nome = entidade.package.nome.substring(1, entidade.package.nome.length - 1);
		
		validaAtributo(entidade.atributos.atributo);
		if(entidade.atributos.atributoMais.size() > 0){
			for(atributo: entidade.atributos.atributoMais){
				validaAtributo(atributo)
			}
		}
	}
	
	def validaAtributo(Atributo atributo){
		atributo.nomeAtributo.nome = atributo.nomeAtributo.nome.substring(1, atributo.nomeAtributo.nome.length - 1);
		
		if(atributo.atributoTipo.tipoPrimitivo !== null){
			atributo.atributoTipo.tipoPrimitivo = atributo.atributoTipo.tipoPrimitivo.substring(1, atributo.atributoTipo.tipoPrimitivo.length-1);
		}else if(atributo.atributoTipo.tipoColecao !== null){
			atributo.atributoTipo.tipoColecao = atributo.atributoTipo.tipoColecao.substring(1, atributo.atributoTipo.tipoColecao.length-1);
		}else{
			atributo.atributoTipo.tipoObjeto = atributo.atributoTipo.tipoObjeto.substring(1, atributo.atributoTipo.tipoObjeto.length-1);
		}
		
		if(!atributo.associacao.associacao.equals("")){
			atributo.associacao.associacao = atributo.associacao.associacao.substring(1, atributo.associacao.associacao.length-1)
		}
		
		if(atributo.operacao !== null){
			atributo.operacao.opCascada.operacao = atributo.operacao.opCascada.operacao.substring(1, atributo.operacao.opCascada.operacao.length - 1);		
			if(atributo.operacao.opCascadaMais.size() > 0){
				for(operacao: atributo.operacao.opCascadaMais){
					operacao.operacao = operacao.operacao.substring(1, operacao.operacao.length - 1);
				}
			}
		}
	}
	
	//@Check
	def validaNomeEntidade(Entidades entidades){
		if(entidadeValidator.verificaNomesEntidade(entidades) !== null){
			var Exception erro = entidadeValidator.verificaNomesEntidade(entidades);
			error(erro.erro, erro.feature);
		}
	}
}
